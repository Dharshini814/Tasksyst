<!DOCTYPE html>
<html>
<head>
  <title>Task Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
 <style>
body{
  font-family:'Segoe UI', sans-serif;
  background:#f4f6f9;
  padding:10px;
  font-size:13px;
}

.container{
  max-width:400px;
  margin:15px auto;
}

.header{
  display:flex;
  align-items:center;
  gap:12px;
}

.icon-box{
  background:#1f3a8a;
  color:white;
  padding:12px;
  border-radius:14px;
  font-size:18px;
}

.header h1{
  margin:0;
  font-size:20px;
}

.header p{
  margin:2px 0 0;
  font-size:12px;
}

.stats{
  display:grid;
  grid-template-columns: repeat(2,1fr);
  gap:10px;
  margin:15px 0;
}

.stat-card{
  background:white;
  padding:7px;
  border-radius:14px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
  text-align:center;
}

.stat-card h2{
  margin:0;
  font-size:16px;
}

.stat-card span{
  font-size:12px;
}

.search{
  width:100%;
  padding:8px;
  border-radius:14px;
  border:none;
  box-shadow:0 3px 8px rgba(0,0,0,0.08);
  margin-bottom:12px;
  font-size:12px;
}

.new-task{
  width:23%;
  background:#1f3a8a;
  color:white;
  padding:8px;
  border-radius:14px;
  border:none;
  font-size:12px;
  margin-bottom:12px;
}

input, select{
  padding:6px 8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin:2px auto;
  font-size:12px;
  width:55%;
  box-sizing:border-box;
}

.filter-section{
  margin:8px 0;
}

.filter-section p{
  margin:4px 0;
  font-size:12px;
}

.filter-section button{
  padding:6px 10px;
  border-radius:14px;
  font-size:13px;
  font-weight:500;
  margin:4px;
  border:none;
}

.filter-section button:not(.reset-btn){
  background:#e5e7eb;
}

.reset-btn{
  background:linear-gradient(45deg,#ff4e50,#f9d423);
  color:white;
}

.card{
  background:white;
  padding:7px;
  margin:8px 0;
  border-radius:14px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
  font-size:12px;
}

button{
  padding:4px 8px;
  font-size:11px;
  border:none;
  border-radius:12px;
  margin:3px;
  cursor:pointer;
}

.edit-btn{
  background:#f59e0b;
  color:white;
}

.delete-btn{
  background:#ef4444;
  color:white;
}
</style>
</head>
<body>

<div class="container">

  <div class="header">
    <div class="icon-box">ðŸ“‹</div>
    <div>
      <h1>Tasks</h1>
      <p>Manage your work, stay on track.</p>
    </div>
  </div>

  <div class="stats">
    <div class="stat-card">
      <h2 id="total">0</h2>
      <span>Total</span>
    </div>

    <div class="stat-card">
      <h2 id="todo">0</h2>
      <span>To Do</span>
    </div>

    <div class="stat-card">
      <h2 id="progress">0</h2>
      <span>In Progress</span>
    </div>

    <div class="stat-card">
      <h2 id="done">0</h2>
      <span>Done</span>
    </div>
  </div>

  <input type="text" id="search" placeholder="ðŸ” Search tasks..." onkeyup="render()" class="search">

  <button id="mainBtn" onclick="addTask()" class="new-task">+ New Task</button>

  <div style="margin-bottom:15px;">
    <input type="text" id="title" placeholder="Task Title">

    <select id="status">
      <option>To Do</option>
      <option>In Progress</option>
      <option>Done</option>
    </select>

    <select id="priority">
      <option>High</option>
      <option>Medium</option>
      <option>Low</option>
    </select>

    <input type="date" id="dueDate">
  </div>

  <div class="filter-section">
    <p>Status:</p>
    <button onclick="setStatus('All')">All</button>
    <button onclick="setStatus('To Do')">To Do</button>
    <button onclick="setStatus('In Progress')">In Progress</button>
    <button onclick="setStatus('Done')">Done</button>
  </div>

  <div class="filter-section">
    <p>Priority:</p>
    <button onclick="setPriority('All')">All</button>
    <button onclick="setPriority('High')">High</button>
    <button onclick="setPriority('Medium')">Medium</button>
    <button onclick="setPriority('Low')">Low</button>
    <button onclick="resetFilters()" class="reset-btn">Reset</button>
  </div>

  <div id="list"></div>

</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let currentStatus = "All";
let currentPriority = "All";  
let editId = null;

/* ðŸ”” Request Notification Permission */
if ("Notification" in window) {
  Notification.requestPermission().then(permission => {
    console.log("Notification permission:", permission);
  });
}

function save(){
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

function addTask(){
  let title = document.getElementById("title").value.trim();
  let status = document.getElementById("status").value;
  let priority = document.getElementById("priority").value;
  let dueDate = document.getElementById("dueDate").value;

  if(title==="") return alert("Enter title");

  if(editId === null){
    tasks.push({id: Date.now(), title, status, priority, dueDate});
  } else {
    let task = tasks.find(t => t.id === editId);
    task.title = title;
    task.status = status;
    task.priority = priority;
    task.dueDate = dueDate;
    editId = null;
    document.getElementById("mainBtn").innerText = "+ New Task";
  }

  document.getElementById("title").value="";
  document.getElementById("dueDate").value = "";
  document.getElementById("status").value = "To Do";
  document.getElementById("priority").value = "High";

  save();
  render();
}

function checkDueNotifications(){
  let today = new Date();
  today.setHours(0,0,0,0);

  tasks.forEach(task => {

    if(!task.dueDate) return;

    let due = new Date(task.dueDate);
    due.setHours(0,0,0,0);

    let diffDays = Math.floor((due - today) / (1000 * 60 * 60 * 24));

    if(Notification.permission === "granted"){

      if(diffDays === 1){
        new Notification("â° Task Due Tomorrow!", {
          body: task.title + " is due tomorrow."
        });
      }

      if(diffDays === 0){
        new Notification("ðŸ”” Task Due Today!", {
          body: task.title + " is due today."
        });
      }

    }

  });
}

/* ðŸ”¥ Run once immediately */
checkDueNotifications();

/* ðŸ” Then check every 1 minute */
setInterval(checkDueNotifications, 60000);

function setPriority(priority){
  currentPriority = priority;
  render();
}

function setStatus(status){
  currentStatus = status;
  render();
}

function resetFilters(){
  currentStatus = "All";
  currentPriority = "All";
  document.getElementById("search").value = "";
  render();
}

function deleteTask(id){
  tasks = tasks.filter(t => t.id !== id);
  save();
  render();
}

function editTask(id){
  let task = tasks.find(t => t.id === id);

  document.getElementById("title").value = task.title;
  document.getElementById("status").value = task.status;
  document.getElementById("priority").value = task.priority;
  document.getElementById("dueDate").value = task.dueDate || "";

  editId = id;
  document.getElementById("mainBtn").innerText = "Update";
}

function render(){
  document.getElementById("total").innerText = tasks.length;
  document.getElementById("todo").innerText =
    tasks.filter(t=>t.status==="To Do").length;

  document.getElementById("progress").innerText =
    tasks.filter(t=>t.status==="In Progress").length;

  document.getElementById("done").innerText =
    tasks.filter(t=>t.status==="Done").length;

  let list = document.getElementById("list");
  list.innerHTML="";

  let searchText = document.getElementById("search").value.toLowerCase();

  let filtered = tasks.filter(t =>
    (currentStatus==="All" || t.status===currentStatus) &&
    (currentPriority==="All" || t.priority===currentPriority) &&
    t.title.toLowerCase().includes(searchText)
  );

  filtered.forEach(t=>{
    let borderColor = "#ccc";
    if(t.priority === "High") borderColor = "green";
    if(t.priority === "Medium") borderColor = "orange";
    if(t.priority === "Low") borderColor = "red";

    list.innerHTML += `
      <div class="card" style="border-left:6px solid ${borderColor}">
        <b>${t.title}</b><br>
        Status: ${t.status} <br>
        Priority: ${t.priority} <br>
        Due: ${t.dueDate ? t.dueDate : "No date"} <br><br>

        <button class="edit-btn" onclick="editTask(${t.id})">Edit</button>
        <button class="delete-btn" onclick="deleteTask(${t.id})">Delete</button>
      </div>
    `;
  });
}

render();
</script>
</body>
</html>